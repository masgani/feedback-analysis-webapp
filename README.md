# AI フィードバック分析 Web アプリケーション

## 概要
本リポジトリは、アンケート形式のフィードバックCSVを入力として受け取り、
日本語テキストの感情分析（ポジ／ニュートラル／ネガ）を自動で実行し、
結果を可視化・ダウンロード可能なWebアプリケーションです。

## 特徴
- Streamlit を用いたシンプルな Web UI
- 日本語 BERT による感情推論
- 部署情報がある場合のみ適用される追加ルール
- FastAPI による推論API（UIと分離）
- Docker による再現可能な実行環境

## 主な機能
- CSV ファイルアップロード
- 日本語テキスト感情分析（ポジ / ニュートラル / ネガ）
- 部署別件数、スコア分布、感情分布の可視化
- ワードクラウド生成（日本語対応）
- 分析結果CSVのダウンロード
- Docker / Docker Compose による簡単起動


## アーキテクチャ概要
本アプリケーションは、以下の構成で実装されています。

- Frontend: Streamlit  
  - CSVアップロード
  - 可視化・ダウンロード
- Backend: FastAPI  
  - 感情分析推論API（/predict）
- Core:
  - 前処理・推論・ルール・集計ロジック

UIと推論ロジックを分離することで、
将来的なUI変更や他システムからのAPI利用を容易にしています。


## 感情分析アルゴリズム概要

## 入力 CSV 仕様

### 必須カラム
- answer_text  
  感情分析対象となる日本語テキスト

### 任意カラム
- department  
  部署名。存在する場合のみ、部署別ルールが適用されます。

- satisfaction_score  
  満足度スコア。可視化のみに使用されます。


### 使用モデル
- koheiduck/bert-japanese-finetuned-sentiment
- 日本語 BERT による 3 クラス分類

## 任意カラムが存在しない場合の挙動
- department が存在しない場合  
  → 部署別ルールは無効化されます。
- satisfaction_score が存在しない場合  
  → スコア分布グラフは表示されません。


### 推論フロー
1. テキストが空の場合 → ニュートラル
2. モデル推論（softmax）
3. 信頼度が閾値未満の場合 → ニュートラル
4. グローバル中立マーカー判定
5. 部署別ルール（該当時）
6. グローバルポジティブマーカー判定

## API 仕様（簡易）

本アプリケーションでは、FastAPI を用いて  
アンケート CSV 向けの **バッチ感情分析推論 API** を提供しています。

本 API は Web UI（Streamlit）から内部的に利用されており、  
複数テキストを一括で推論することを想定しています。

---

### エンドポイント一覧

#### POST `/predict`

複数の日本語テキストを入力として受け取り、  
各テキストに対する感情ラベルおよび信頼度スコアを返します。

#### GET `/health`

API の稼働状態を確認するためのヘルスチェック用エンドポイントです。

---

### リクエスト仕様（/predict）


**Body（JSON）**

```json
{
  "texts": [
    "とても満足しています",
    "対応が遅くて不満です"
  ],
  "depts": [
    "営業",
    "サポート"
  ],
  "use_dept_rules": true
}
```

### レスポンス仕様

**Body（JSON）**

```json
{
  "labels": [
    "ポジ",
    "ネガ"
  ],
  "scores": [
    0.92,
    0.93
  ]
}
```

### 実行方法（Docker 推奨）
1. リポジトリをクローン
```bash
git clone https://github.com/masgani/feedback-analysis-webapp.git
cd feedback-analysis-webapp
```

2. Docker Compose で起動
```bash
docker compose up --build
```

3. アクセス Web UI（Streamlit）
```bash
http://localhost:8501
```

## Web アプリの操作方法

本 Web アプリケーションでは、以下の **2 通りの操作方法** を提供しています。  
いずれの場合も、CSV 読み込み後に自動で感情分析および可視化が実行されます。

---

### 操作①：ユーザー独自の CSV ファイルをアップロードする場合

1. 画面上部の **「Browse files」** ボタン、  
   もしくはドラッグ＆ドロップで CSV ファイルをアップロードします。
2. CSV 読み込み完了後、以下の処理が自動で実行されます。
   - 感情分析（ポジ／ニュートラル／ネガ）
   - 推論結果のプレビュー表示
   - 各種グラフ（感情分布・部署別件数・スコア分布など）の生成
3. 処理完了までに **約 10〜30 秒** 程度かかる場合があります。
4. 画面下部の **「分析結果CSVをダウンロード」** ボタンから、  
   感情推論結果を含む CSV ファイルをダウンロードできます。

---

### 操作②：サンプルデータを使用したデモ実行

1. **「サンプルデータを使用（data/feedback.csv）」** にチェックを入れます。
2. 提供済みの `feedback.csv` を用いて感情分析が自動で実行されます。
3. 以下の内容を確認できます。
   - 感情分析結果のプレビュー
   - 可視化グラフの表示例
   - 分析結果 CSV のダウンロード

※ 本操作は **画面表示や機能確認を目的としたデモ用途** を想定しています。

---

### 共通仕様

- CSV 読み込み後、追加操作なしで自動的に分析が開始されます。
- 推論結果は画面表示と同時に、CSV ダウンロード用データとしても生成されます。
- UI 操作は最小限に抑え、直感的に利用できる設計としています。